@using Ecommerce3.Domain.Entities
@using Ecommerce3.Domain.Enums
@model Ecommerce3.StoreFront.ViewModels.Category.CategoryLevel0ViewModel

@section Styles{
    <link rel="stylesheet" href="~/css/spice-listing.css" asp-append-version="true">
    <link rel="stylesheet" href="~/css/tingle.min.css" asp-append-version="true">
}

@* Breadcrumb *@
<partial name="_BreadcrumbPartial" model="@Model.Breadcrumb"/>

@* Category *@
<input type="hidden" id="category" data-id="@Model.Category.Id" data-slug="@Model.Category.Slug"/>
@Html.AntiForgeryToken()

<div class="cat-content">
    <div class="container">
        <h1>@Model.Category.Display</h1>
    </div>
</div>

@* Category children *@
@if (Model.Category.Children.Count > 0)
{
    <div class="container">
        <div class="category-cards">
            @foreach (var child in Model.Category.Children)
            {
                <div class="catcard">
                    <a asp-controller="Categories" asp-action="CategoryLevel1"
                       asp-route-category0Slug="@Model.Category.Slug"
                       asp-route-category1Slug="@child.Slug">
                        @if (child.ListItemImage != null)
                        {
                            <img src="@child.ListItemImage.FileExtension"
                                 alt="@child.ListItemImage!.AltText"
                                 title="@child.ListItemImage.Title" width="350" height="350"/>
                        }
                        else
                        {
                            <img src="@($"https://placehold.co/600x400?text={child.Name}")" alt="@child.Slug"
                                 width="350" height="350"/>
                        }
                        <span>@child.Display</span>
                    </a>
                </div>
            }
        </div>
    </div>
}

<section id="listing">
    <div id="product">
        <div class="listingbg-new">
            <div class="products_main">
                <div class="products" id="products">
                    <div class="product_container">
                        <div class="sortresult-wrapper">
                            <div class="sort_results">
                                <div class="total_products">
                                    <span class="block_count">@Model.Products.TotalItems.ToString() Products</span>
                                </div>
                                <form id="OrderByform">
                                    <div class="sortby-dropdown">
                                        <span class="sort-title">Sort By:</span>
                                        <select id="sort_order">
                                            <option value="@nameof(SortOrder.NameAsc)">Name (Ascending)</option>
                                            <option value="@nameof(SortOrder.NameDesc)">Name (Descending)</option>
                                            <option value="@nameof(SortOrder.PriceAsc)">Price (Low to High)</option>
                                            <option value="@nameof(SortOrder.PriceDesc)">Price (High to Low)</option>
                                            <option value="@nameof(SortOrder.DiscountDesc)">Discount</option>
                                            <option value="@nameof(SortOrder.RatingDesc)">Avg. Rating</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <partial name="_PLPProductListPartial" model="@Model.Products"/>
                        @* @if (Model.Products.TotalItems > Model.Products.PageSize * Model.Products.PageNumber) *@
                        @* { *@
                        @*     <div id="load_more_container" class="bottom_pagination"> *@
                        @*         <button id="load_more" data-page="2" class="lmb">Load More</button> *@
                        @*     </div> *@
                        @* } *@
                        <div id="load_more_container"
                             class="bottom_pagination @(Model.Products.TotalItems <= Model.Products.PageSize * Model.Products.PageNumber ? "d-none" : "")">
                            <button id="load_more" data-page="2" class="lmb">Load More</button>
                        </div>
                    </div>
                </div>
                <div class="filters cat_page">
                    <span class="filter-caption">Filters</span>
                    <div id="filters">
                        <form id="filterform" action="">
                            <ul class="accordion side_filters">
                                @* Brands start *@
                                <li class="accordion-item">
                                    <span role="button" class="accordion-title" name="Brand" aria-controls="Brand"
                                          aria-expanded="true" tabindex="0">Brand</span>
                                    <div class="accordion-content filter-div grid" aria-hidden="false"
                                         aria-labelledby="Brand" id="Brand">
                                        <ul>
                                            @if (Model.Brands.Count == 1)
                                            {
                                                var brand = Model.Brands.First();
                                                <li class="element-item brand">
                                                    <input type="checkbox" id="@($"brand_{brand.Id}")" data-entity="@nameof(Brand)"
                                                           data-brand-id="@brand.Id"
                                                           checked="checked" disabled>
                                                    <div class="checkbox__checkmark"></div>
                                                    <label class="fancy-checkbox" for="@($"brand_{brand.Id}")">
                                                        @brand.Text
                                                        @* <span>(99)</span> *@
                                                    </label>
                                                </li>
                                            }
                                            else
                                            {
                                                @foreach (var brand in Model.Brands)
                                                {
                                                    <li class="element-item brand">
                                                        <input type="checkbox" id="@brand.Id"
                                                               data-entity="@nameof(Brand)"
                                                               @(brand.IsSelected ? "checked" : "") disabled>
                                                        <div class="checkbox__checkmark"></div>
                                                        <label class="fancy-checkbox" for="@brand.Id">
                                                            @brand.Text
                                                            @* <span>(99)</span> *@
                                                        </label>
                                                    </li>
                                                }
                                            }
                                        </ul>
                                    </div>
                                </li>
                                @* Brands end *@

                                @* Weight facet start *@
                                <li class="accordion-item">
                                    <span role="button" class="accordion-title" name="Weight" aria-controls="Weight"
                                          aria-expanded="true" tabindex="0">Weight</span>
                                    <div class="accordion-content filter-div grid" aria-hidden="false"
                                         aria-labelledby="Weight" id="Weight">
                                        <ul>
                                            @foreach (var weight in Model.Weights)
                                            {
                                                <li class="element-item brand">
                                                    <input type="checkbox" id="@weight.Text"
                                                           data-entity="Weight"
                                                           data-qty-per-uom="@weight.Tags[0]"
                                                           data-uom-name="@weight.Tags[1]"
                                                           @(weight.IsSelected ? "checked" : "")>
                                                    <div class="checkbox__checkmark"></div>
                                                    <label class="fancy-checkbox" for="@weight.Text">
                                                        @weight.Text
                                                        @* <span>(29)</span> *@
                                                    </label>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </li>
                                @* Weight facet end *@

                                <li class="accordion-item">
                                    <span role="button" class="accordion-title" name="Price" aria-controls="Price"
                                          aria-expanded="true" tabindex="0">Price</span>
                                    <div class="accordion-content filter-div grid" aria-hidden="false"
                                         aria-labelledby="Price" id="Price">

                                        <ul>
                                            <li class="element-item brand">
                                                <input type="checkbox" id="price-one">
                                                <div class="checkbox__checkmark"></div>
                                                <label id="l_Almonds" class="fancy-checkbox" for="price-one">
                                                    £0.00 - £99.99
                                                    <span>(102)</span>
                                                </label>
                                            </li>
                                            <li class="element-item brand">
                                                <input type="checkbox" id="price-two">
                                                <div class="checkbox__checkmark"></div>
                                                <label id="l_Brazil Nuts" class="fancy-checkbox" for="price-two">
                                                    £100.00 and above
                                                    <span>(1)</span>
                                                </label>
                                            </li>
                                        </ul>
                                    </div>

                                </li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="cat-bottom-section">
    <div class="container">
        <div class="bottom-content-wrapper">
            <h3 class="small-heading">@Model.Category.Display</h3>
            @Html.Raw(Model.Category.FullDescription)
        </div>
    </div>
</section>

<template id="modal-basket">
    <div class="basket-card">
        <div class="basket-content">
            <div class="basket-image">
                <img src="images/product-250x250.jpg" width="250" height="250" alt="Organic Brown Linseeds">
            </div>

            <div class="basket-details">
                <div class="title-rating">
                    <h1 class="basket-title">Organic Brown Linseeds</h1>
                    <div class="prating">
                        <span class="rating-con three-half-star"></span>
                        <span>Based on 10 Ratings</span>
                    </div>
                </div>

                <div class="weight-options">
                    <div class="weight-title">Package size</div>
                    <div class="weight-option">
                        <input type="radio" id="weight-250g" name="weight" value="250g" checked>
                        <label for="weight-250g" class="weight-label">
                            <span class="weight-value">250g</span>
                        </label>
                    </div>
                    <div class="weight-option">
                        <input type="radio" id="weight-500g" name="weight" value="500g">
                        <label for="weight-500g" class="weight-label">
                            <span class="weight-value">500g</span>
                        </label>
                    </div>
                    <div class="weight-option">
                        <input type="radio" id="weight-1kg" name="weight" value="1kg">
                        <label for="weight-1kg" class="weight-label">
                            <span class="weight-value">1kg</span>
                        </label>
                    </div>
                    <div class="weight-option">
                        <input type="radio" id="weight-2kg" name="weight" value="2kg">
                        <label for="weight-1kg" class="weight-label">
                            <span class="weight-value">2kg</span>
                        </label>
                    </div>
                    <div class="weight-option">
                        <input type="radio" id="weight-4kg" name="weight" value="4kg">
                        <label for="weight-1kg" class="weight-label">
                            <span class="weight-value">4kg</span>
                        </label>
                    </div>
                    <div class="weight-option">
                        <input type="radio" id="weight-25kg" name="weight" value="25kg">
                        <label for="weight-22kg" class="weight-label">
                            <span class="weight-value">25kg</span>
                            <span class="discount-badge">10%</span>
                        </label>
                    </div>
                </div>

                <div class="price-section">
                    <span class="current-price">£1.69</span>
                    <span class="price-pipe"></span>
                    <span class="ppkg">£0.68 per 100g</span>
                </div>

                <div class="quantity-section">
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="decreaseQuantity()">−</button>
                        <input type="number" id="quantity" class="quantity-input" value="1" min="1">
                        <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                    </div>
                    <button class="add-to-basket-light"><img src="images/add-to-basket.svg" alt="Add To Basket"
                                                             width="22" height="22">Add to Basket
                    </button>
                </div>
                <a href="#" class="view-details">View Product Details</a>
            </div>
        </div>
    </div>
</template>

<button type="button" class="filter_button hide-for-large" data-toggle="filters">
    <img src="images/bw-filter-icon.svg" alt="Filter">
    Filters
</button>

@section Scripts {
    <script src="~/js/tingle.min.js" asp-append-version="true"></script>
    <script src="~/js/menu.js" asp-append-version="true" defer></script>
    <script src="~/js/products.js" asp-append-version="true"></script>
}