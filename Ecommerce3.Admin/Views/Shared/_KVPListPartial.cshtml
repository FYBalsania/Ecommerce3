@using Ecommerce3.Domain.Enums
@model ValueTuple<string, int, Ecommerce3.Domain.Enums.KVPListItemType, IReadOnlyList<Ecommerce3.Contracts.DTOs.KVPListItem.KVPListItemDTO>>

@{
    var kvpType = Model.Item3.ToString();
    var prefix = "kvp-" + kvpType;
    
    ViewData["KVPPrefix"] = prefix;
    ViewData["KVPTableId"] = $"{prefix}-List";
    
    var kvpAddModalId = $"{prefix}-AddModal";
    var kvpEditModalId = $"{prefix}-EditModal";
    var kvpDeleteModalId = $"{prefix}-DeleteModal";
}

<div class="card mb-4">
    <input type="hidden" id="@prefix-TextListItemType" value="@kvpType"/>
    <input type="hidden" class="kvpPrefix" value="@prefix" />
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-muted py-2">
            @if (kvpType == nameof(KVPListItemType.Nutrition))
            {
                <i class="fas fa-apple-whole"></i>
            }
            @if (kvpType == nameof(KVPListItemType.FAQ))
            {
                <i class="fas fa-circle-question"></i>
            }
            @kvpType
        </h5>
        <a href="javascript:;" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#@kvpAddModalId">
            Add @kvpType
        </a>
    </div>
    <div class="card-body">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                    <tr>
                        <th>Key</th>
                        <th>Value</th>
                        <th class="text-end" style="width: 10%;">Sort Order</th>
                        <th class="text-end" style="width: 15%;">Created</th>
                        <th class="text-center" style="width: 10%;">Action</th>
                    </tr>
                    </thead>
                    <partial name="_KVPListItemsPartial" model="Model.Item4"/>
                </table>
            </div>
        </div>

    </div>
</div>
<!-- Add KVP Modal -->
<div class="modal fade" id="@kvpAddModalId" tabindex="-1" aria-labelledby="@kvpAddModalId-Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-muted" id="@kvpAddModalId-Label">Add @kvpType</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label required">Key</label>
                    <input type="text" class="form-control" id="@prefix-AddKey"/>
                    <span class="text-danger" id="@prefix-AddKeyError"></span>
                </div>
                <div class="mb-3">
                    <label class="form-label required">Value</label>
                    <div id="@prefix-AddValue" style="height: 100px;"></div>
                    <input type="hidden" id="@prefix-AddValue-Input" />
                    <span class="text-danger" id="@prefix-AddValueError"></span>
                </div>
                <div class="mb-3">
                    <label class="form-label required">Sort Order</label>
                    <input type="number" class="form-control" id="@prefix-AddSortOrder"/>
                    <span class="text-danger" id="@prefix-AddSortOrderError"></span>
                </div>
            </div>
            
            <div class="modal-footer">
                <input type="hidden" id="@prefix-AddParentEntity" value="@Model.Item1" />
                <input type="hidden" id="@prefix-AddParentEntityId" value="@Model.Item2"/>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="@prefix-Add-Save">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit KVP Modal -->
<div class="modal fade" id="@kvpEditModalId" tabindex="-1" aria-labelledby="@kvpEditModalId-Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-muted" id="@kvpEditModalId-Label">Edit @kvpType</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label required">Key</label>
                    <input type="text" class="form-control" id="@prefix-EditKey"/>
                    <span class="text-danger" id="@prefix-EditKeyError"></span>
                </div>
                <div class="mb-3">
                    <label class="form-label required">Value</label>
                    <div id="@prefix-EditValue" style="height: 100px;"></div>
                    <input type="hidden" id="@prefix-EditValue-Input" />
                    <span class="text-danger" id="@prefix-EditValueError"></span>
                </div>
                <div class="mb-3">
                    <label class="form-label required">Sort Order</label>
                    <input type="number" class="form-control" id="@prefix-EditSortOrder"/>
                    <span class="text-danger" id="@prefix-EditSortOrderError"></span>
                </div>
            </div>
            
            <div class="modal-footer">
                <input type="hidden" id="@prefix-EditParentEntity" value="@Model.Item1" />
                <input type="hidden" id="@prefix-EditParentEntityId" value="@Model.Item2"/>
                <input type="hidden" id="@prefix-EditId"/>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="@prefix-Edit-Save">Update</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete KVP Modal -->
<div class="modal fade" id="@kvpDeleteModalId" tabindex="-1" aria-labelledby="@kvpDeleteModalId-Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header">
                <h5 class="modal-title">Delete @kvpType</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                Are you sure you want to delete <span class="text-danger" id="@prefix-DeleteKey"></span>?
            </div>
            <div class="modal-footer">
                <input type="hidden" id="@prefix-DeleteParentEntity" value="@Model.Item1" />
                <input type="hidden" id="@prefix-DeleteParentEntityId" value="@Model.Item2"/>
                <input type="hidden" id="@prefix-DeleteId"/>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="@prefix-Delete">Delete</button>
            </div>
        </div>
    </div>
</div>
@section Scripts
{
    <script>
        // Initialize Quill for KVP Add Editor
        var valueAddQuill = new Quill('#@prefix-AddValue', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{header: [1, 2, 3, false]}],
                    [{font: []}],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{color: []}, {background: []}],
                    [{list: 'ordered'}, {list: 'bullet'}],
                    [{align: []}],
                    ['link', 'image', 'blockquote', 'code-block'],
                    ['clean']
                ]
            }
        });
        valueAddQuill.on('text-change', function () {
            document.getElementById('@prefix-AddValue-Input').value = valueAddQuill.root.innerHTML;
        });

        // Initialize Quill for KVP Add Editor
        var valueEditQuill = new Quill('#@prefix-EditValue', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{header: [1, 2, 3, false]}],
                    [{font: []}],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{color: []}, {background: []}],
                    [{list: 'ordered'}, {list: 'bullet'}],
                    [{align: []}],
                    ['link', 'image', 'blockquote', 'code-block'],
                    ['clean']
                ]
            }
        });
        valueEditQuill.on('text-change', function () {
            document.getElementById('@prefix-EditValue-Input').value = valueEditQuill.root.innerHTML;
        });
    </script>
}
